version: '3.8'

services:
  health-backend:
    build: ./server
    container_name: health-backend
    restart: unless-stopped
    environment:
      - PORT=8081
      - DB_PATH=/data/health.db
      # You need to pass these env vars at runtime or via a .env file on the server
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - SESSION_SECRET=${SESSION_SECRET}
    volumes:
      - health-data:/data
    networks:
      - health-network

  health-frontend:
    build: ./client
    container_name: health-frontend
    restart: unless-stopped
    ports:
      - "8081:80" # Maps port 8081 on host to 80 in container
    depends_on:
      - health-backend
    networks:
      - health-network

volumes:
  health-data:

networks:
  health-network:
    driver: bridge
